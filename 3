 def _open_programs_management(self):
        """ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙˆØ§Ù„Ø¯ÙˆØ±Ø§Øª Ø¨ØªØµÙ…ÙŠÙ… Ù…Ø­Ø³Ù†"""

        # Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù† Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
        self._create_programs_tables()

        # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø§ÙØ°Ø©
        programs_window = tk.Toplevel(self)
        programs_window.title("Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙˆØ§Ù„Ø¯ÙˆØ±Ø§Øª")
        programs_window.state('zoomed')
        programs_window.configure(bg=self.COLORS["background"])
        programs_window.transient(self)
        programs_window.grab_set()

        # Ù…ØªØºÙŠØ±Ø§Øª Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        programs_data = {}  # Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù…Ù†Ø´Ø£Ø©
        selected_courses_for_program = []  # Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù„Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
        all_courses_data = {}  # Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ±Ø§Øª

        # ================== Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø¨ØªØµÙ…ÙŠÙ… Ø£Ù†ÙŠÙ‚ ==================
        header = tk.Frame(programs_window, bg="#2c3e50", height=120)
        header.pack(fill=tk.X)
        header.pack_propagate(False)

        header_content = tk.Frame(header, bg="#2c3e50")
        header_content.pack(expand=True, fill=tk.BOTH)

        tk.Label(
            header_content,
            text="Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©",
            font=("Tajawal", 32, "bold"),
            bg="#2c3e50",
            fg="white"
        ).pack(pady=(25, 5))

        tk.Label(
            header_content,
            text="Ù‚Ù… Ø¨ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ±Ø§Øª ÙÙŠ Ø¨Ø±Ø§Ù…Ø¬ ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ù…ÙˆØ­Ø¯Ø©",
            font=("Tajawal", 16),
            bg="#2c3e50",
            fg="#ecf0f1"
        ).pack()

        # Ø¥Ø·Ø§Ø± Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ
        buttons_frame = tk.Frame(header, bg="#2c3e50")
        buttons_frame.place(relx=0.98, rely=0.5, anchor="e")

        # Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel
        def export_programs():
            """ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø¥Ù„Ù‰ Excel Ù…Ø¹ ØªÙØ§ØµÙŠÙ„ Ù…Ø­Ø³Ù†Ø©"""
            cursor = self.db_conn.cursor()
            cursor.execute("SELECT COUNT(*) FROM programs")
            count = cursor.fetchone()[0]

            if count == 0:
                messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø±Ø§Ù…Ø¬ Ù„Ù„ØªØµØ¯ÙŠØ±")
                return

            try:
                import pandas as pd
                from tkinter import filedialog
                import datetime

                file_path = filedialog.asksaveasfilename(
                    defaultextension=".xlsx",
                    filetypes=[("Excel files", "*.xlsx")],
                    initialfile=f"Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬_Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©_{datetime.datetime.now().strftime('%Y%m%d_%H%M%S')}.xlsx"
                )

                if not file_path:
                    return

                # Ø¬Ù„Ø¨ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                cursor.execute("""
                    SELECT p.id, p.program_name, p.program_description
                    FROM programs p
                    ORDER BY p.id DESC
                """)
                programs = cursor.fetchall()

                with pd.ExcelWriter(file_path, engine='openpyxl') as writer:
                    # ================== Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ù…Ù„Ø®Øµ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø¨ØªÙØ§ØµÙŠÙ„ Ø£ÙƒØ«Ø± ==================
                    summary_data = []
                    for prog in programs:
                        prog_id = prog[0]

                        # Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ÙØµÙ„Ø© Ù„Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
                        cursor.execute("""
                            SELECT 
                                COUNT(DISTINCT pc.course_id) as courses_count,
                                COUNT(DISTINCT part.id) as total_participants,
                                SUM(CASE WHEN part.participant_status IN ('Ù…Ø¬ØªØ§Ø²', 'Ø¨Ø§Ø´Ø±') THEN 1 ELSE 0 END) as passed_count,
                                SUM(CASE WHEN part.participant_status = 'Ø¥Ù„ØºØ§Ø¡ Ø¯ÙˆØ±Ø©' THEN 1 ELSE 0 END) as cancelled_count,
                                SUM(CASE WHEN part.participant_status = 'Ù„Ù… ÙŠØ¨Ø§Ø´Ø±' THEN 1 ELSE 0 END) as not_started_count,
                                SUM(CASE WHEN part.participant_status NOT IN ('Ù…Ø¬ØªØ§Ø²', 'Ø¨Ø§Ø´Ø±', 'Ø¥Ù„ØºØ§Ø¡ Ø¯ÙˆØ±Ø©', 'Ù„Ù… ÙŠØ¨Ø§Ø´Ø±') 
                                    AND part.participant_status IS NOT NULL THEN 1 ELSE 0 END) as other_status_count
                            FROM program_courses pc
                            LEFT JOIN courses c ON pc.course_id = c.id
                            LEFT JOIN participants part ON c.id = part.course_id
                            WHERE pc.program_id = ?
                        """, (prog_id,))

                        stats = cursor.fetchone()

                        # Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
                        total_participants = stats[1] if stats[1] else 0
                        passed_count = stats[2] if stats[2] else 0
                        success_rate = (passed_count / total_participants * 100) if total_participants > 0 else 0

                        summary_data.append({
                            'Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬': prog[1],
                            'Ø§Ù„ÙˆØµÙ': prog[2] if prog[2] else '',
                            'Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª': stats[0] if stats[0] else 0,
                            'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†': total_participants,
                            'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¬ØªØ§Ø²ÙŠÙ†': passed_count,
                            'Ø¥Ù„ØºØ§Ø¡ Ø¯ÙˆØ±Ø©': stats[3] if stats[3] else 0,
                            'Ù„Ù… ÙŠØ¨Ø§Ø´Ø±': stats[4] if stats[4] else 0,
                            'Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰': stats[5] if stats[5] else 0,
                            'Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ %': f"{success_rate:.1f}"
                        })

                    summary_df = pd.DataFrame(summary_data)
                    summary_df.to_excel(writer, sheet_name='Ù…Ù„Ø®Øµ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬', index=False)

                    # ================== Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª (Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·) ==================
                    details_data = []
                    for prog in programs:
                        prog_id = prog[0]
                        prog_name = prog[1]

                        # Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù…Ø¹ ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©
                        cursor.execute("""
                            SELECT 
                                c.course_code, 
                                c.course_name, 
                                c.course_category,
                                DATE(c.start_date) as start_date,
                                DATE(c.end_date) as end_date,
                                COUNT(DISTINCT p.id) as total_participants,
                                SUM(CASE WHEN p.participant_status IN ('Ù…Ø¬ØªØ§Ø²', 'Ø¨Ø§Ø´Ø±') THEN 1 ELSE 0 END) as passed,
                                SUM(CASE WHEN p.participant_status = 'Ø¥Ù„ØºØ§Ø¡ Ø¯ÙˆØ±Ø©' THEN 1 ELSE 0 END) as cancelled,
                                SUM(CASE WHEN p.participant_status = 'Ù„Ù… ÙŠØ¨Ø§Ø´Ø±' THEN 1 ELSE 0 END) as not_started
                            FROM program_courses pc
                            JOIN courses c ON pc.course_id = c.id
                            LEFT JOIN participants p ON c.id = p.course_id
                            WHERE pc.program_id = ?
                            GROUP BY c.id
                            ORDER BY c.start_date
                        """, (prog_id,))

                        courses = cursor.fetchall()
                        for course in courses:
                            details_data.append({
                                'Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬': prog_name,
                                'Ø±Ù‚Ù… Ø§Ù„Ø¯ÙˆØ±Ø©': course[0],
                                'Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©': course[1],
                                'ÙØ¦Ø© Ø§Ù„Ø¯ÙˆØ±Ø©': course[2] if course[2] else '',
                                'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©': course[3] if course[3] else '',
                                'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©': course[4] if course[4] else '',
                                'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†': course[5] if course[5] else 0,
                                'Ø§Ù„Ù…Ø¬ØªØ§Ø²ÙŠÙ†': course[6] if course[6] else 0,
                                'Ø¥Ù„ØºØ§Ø¡ Ø¯ÙˆØ±Ø©': course[7] if course[7] else 0,
                                'Ù„Ù… ÙŠØ¨Ø§Ø´Ø±': course[8] if course[8] else 0
                            })

                    if details_data:
                        details_df = pd.DataFrame(details_data)
                        details_df.to_excel(writer, sheet_name='ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª', index=False)

                    # ================== Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©: Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ==================
                    stats_data = []
                    for prog in programs:
                        prog_id = prog[0]
                        prog_name = prog[1]

                        # Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ÙØµÙ„Ø© Ù„ÙƒÙ„ Ø¨Ø±Ù†Ø§Ù…Ø¬
                        cursor.execute("""
                            SELECT 
                                MIN(DATE(c.start_date)) as earliest_start,
                                MAX(DATE(c.end_date)) as latest_end,
                                COUNT(DISTINCT c.course_category) as category_count,
                                COUNT(DISTINCT p.department) as department_count,
                                AVG(CASE WHEN p.participant_status IN ('Ù…Ø¬ØªØ§Ø²', 'Ø¨Ø§Ø´Ø±') THEN 100.0 ELSE 0 END) as avg_success_rate
                            FROM program_courses pc
                            JOIN courses c ON pc.course_id = c.id
                            LEFT JOIN participants p ON c.id = p.course_id
                            WHERE pc.program_id = ?
                        """, (prog_id,))

                        prog_stats = cursor.fetchone()

                        # Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
                        if prog_stats[0] and prog_stats[1]:
                            try:
                                start_date = datetime.datetime.strptime(prog_stats[0], '%Y-%m-%d')
                                end_date = datetime.datetime.strptime(prog_stats[1], '%Y-%m-%d')
                                duration_days = (end_date - start_date).days
                            except:
                                duration_days = 0
                        else:
                            duration_days = 0

                        stats_data.append({
                            'Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬': prog_name,
                            'Ø£ÙˆÙ„ Ø¯ÙˆØ±Ø© (Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©)': prog_stats[0] if prog_stats[0] else '',
                            'Ø¢Ø®Ø± Ø¯ÙˆØ±Ø© (Ø§Ù„Ù†Ù‡Ø§ÙŠØ©)': prog_stats[1] if prog_stats[1] else '',
                            'Ø§Ù„Ù…Ø¯Ø© Ø¨Ø§Ù„Ø£ÙŠØ§Ù…': duration_days,
                            'Ø¹Ø¯Ø¯ Ø§Ù„ÙØ¦Ø§Øª': prog_stats[2] if prog_stats[2] else 0,
                            'Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø³ØªÙÙŠØ¯Ø©': prog_stats[3] if prog_stats[3] else 0,
                            'Ù…ØªÙˆØ³Ø· Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ %': f"{prog_stats[4]:.1f}" if prog_stats[4] else "0.0"
                        })

                    if stats_data:
                        stats_df = pd.DataFrame(stats_data)
                        stats_df.to_excel(writer, sheet_name='Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬', index=False)

                    # ================== Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ ==================
                    workbook = writer.book

                    from openpyxl.styles import Font, Alignment, PatternFill, Border, Side
                    from openpyxl.utils import get_column_letter

                    for sheet_name in workbook.sheetnames:
                        worksheet = workbook[sheet_name]

                        # Ø§ØªØ¬Ø§Ù‡ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„ÙŠØ³Ø§Ø±
                        worksheet.sheet_view.rightToLeft = True

                        # ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø£Ø³
                        header_font = Font(name='Tajawal', size=13, bold=True, color='FFFFFF')
                        header_fill = PatternFill(start_color='2c3e50', end_color='2c3e50', fill_type='solid')
                        header_alignment = Alignment(horizontal='center', vertical='center', wrap_text=True)

                        # ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        data_font = Font(name='Tajawal', size=11)
                        data_alignment = Alignment(horizontal='center', vertical='center', wrap_text=True)

                        # Ø­Ø¯ÙˆØ¯
                        thin_border = Border(
                            left=Side(style='thin'),
                            right=Side(style='thin'),
                            top=Side(style='thin'),
                            bottom=Side(style='thin')
                        )

                        # ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ù„Ø§ÙŠØ§
                        for row in worksheet.iter_rows():
                            for cell in row:
                                cell.border = thin_border

                                if cell.row == 1:  # Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ (Ø§Ù„Ø±Ø£Ø³)
                                    cell.font = header_font
                                    cell.fill = header_fill
                                    cell.alignment = header_alignment
                                    worksheet.row_dimensions[1].height = 35
                                else:  # Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØµÙÙˆÙ
                                    cell.font = data_font
                                    cell.alignment = data_alignment

                                    # ØªÙ„ÙˆÙŠÙ† Ø§Ù„ØµÙÙˆÙ Ø¨Ø§Ù„ØªÙ†Ø§ÙˆØ¨
                                    if cell.row % 2 == 0:
                                        cell.fill = PatternFill(start_color='F5F5F5', end_color='F5F5F5',
                                                                fill_type='solid')
                                    else:
                                        cell.fill = PatternFill(start_color='FFFFFF', end_color='FFFFFF',
                                                                fill_type='solid')

                        # Ø¶Ø¨Ø· Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ø¹ ØªÙˆØ³ÙŠØ·
                        for column in worksheet.columns:
                            max_length = 0
                            column_letter = column[0].column_letter

                            for cell in column:
                                try:
                                    if cell.value:
                                        # Ø­Ø³Ø§Ø¨ Ø·ÙˆÙ„ Ø§Ù„Ù†Øµ
                                        cell_length = len(str(cell.value))
                                        if cell_length > max_length:
                                            max_length = cell_length
                                except:
                                    pass

                            # Ø¶Ø¨Ø· Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…ÙˆØ¯
                            adjusted_width = min(max(max_length + 5, 12), 50)
                            worksheet.column_dimensions[column_letter].width = adjusted_width

                        # ØªØ¬Ù…ÙŠØ¯ Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„
                        worksheet.freeze_panes = 'A2'

                        # Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø®Ø§ØµØ© Ø­Ø³Ø¨ Ø§Ù„ÙˆØ±Ù‚Ø©
                        if sheet_name == 'Ù…Ù„Ø®Øµ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬':
                            # ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ù‡Ù…Ø©
                            for row in worksheet.iter_rows(min_row=2):
                                # ØªÙ„ÙˆÙŠÙ† Ø®Ù„ÙŠØ© Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ø­Ø³Ø¨ Ø§Ù„Ù‚ÙŠÙ…Ø©
                                success_cell = row[8]  # Ø¹Ù…ÙˆØ¯ Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
                                try:
                                    value = float(str(success_cell.value).replace('%', ''))
                                    if value >= 80:
                                        success_cell.font = Font(name='Tajawal', size=11, bold=True, color='27ae60')
                                    elif value >= 60:
                                        success_cell.font = Font(name='Tajawal', size=11, bold=True, color='f39c12')
                                    else:
                                        success_cell.font = Font(name='Tajawal', size=11, bold=True, color='e74c3c')
                                except:
                                    pass

                                # ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…Ø¬ØªØ§Ø²ÙŠÙ† Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø®Ø¶Ø±
                                passed_cell = row[4]  # Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ø¬ØªØ§Ø²ÙŠÙ†
                                if passed_cell.value and int(passed_cell.value) > 0:
                                    passed_cell.font = Font(name='Tajawal', size=11, bold=True, color='27ae60')

                                # ØªÙ…ÙŠÙŠØ² Ø¥Ù„ØºØ§Ø¡ Ø¯ÙˆØ±Ø© Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø±
                                cancelled_cell = row[5]  # Ø¹Ù…ÙˆØ¯ Ø¥Ù„ØºØ§Ø¡ Ø¯ÙˆØ±Ø©
                                if cancelled_cell.value and int(cancelled_cell.value) > 0:
                                    cancelled_cell.font = Font(name='Tajawal', size=11, bold=True, color='e74c3c')

                        elif sheet_name == 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª':
                            # Ø¶Ø¨Ø· Ø¹Ø±Ø¶ Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
                            worksheet.column_dimensions['E'].width = 15  # ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                            worksheet.column_dimensions['F'].width = 15  # ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©

                        elif sheet_name == 'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬':
                            # ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ù„ØªÙˆØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù…Ø¯Ø©
                            worksheet.column_dimensions['B'].width = 15  # Ø£ÙˆÙ„ Ø¯ÙˆØ±Ø©
                            worksheet.column_dimensions['C'].width = 15  # Ø¢Ø®Ø± Ø¯ÙˆØ±Ø©
                            worksheet.column_dimensions['D'].width = 12  # Ø§Ù„Ù…Ø¯Ø© Ø¨Ø§Ù„Ø£ÙŠØ§Ù…

                # Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø®Øµ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ù„Ù
                messagebox.showinfo(
                    "Ù†Ø¬Ø§Ø­",
                    f"ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø¨Ù†Ø¬Ø§Ø­!\n\n"
                    f"ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬: {len(programs)}\n"
                    f"ğŸ“„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚: {len(workbook.sheetnames)}\n"
                    f"ğŸ’¾ Ø§Ù„Ù…Ù„Ù: {file_path}\n\n"
                    f"Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙØµØ¯ÙÙ‘Ø±Ø©:\n"
                    f"âœ… Ù…Ù„Ø®Øµ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ù…Ø¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª\n"
                    f"âœ… ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª (Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·)\n"
                    f"âœ… Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ø²Ù…Ù†ÙŠØ©"
                )

                # ÙØªØ­ Ø§Ù„Ù…Ù„Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                import os
                import platform
                import subprocess

                try:
                    if platform.system() == 'Windows':
                        os.startfile(file_path)
                    elif platform.system() == 'Darwin':  # macOS
                        subprocess.call(['open', file_path])
                    else:  # Linux
                        subprocess.call(['xdg-open', file_path])
                except:
                    pass

            except ImportError:
                messagebox.showerror("Ø®Ø·Ø£", "ÙŠØ¬Ø¨ ØªØ«Ø¨ÙŠØª Ù…ÙƒØªØ¨Ø© pandas Ùˆ openpyxl\npip install pandas openpyxl")
            except Exception as e:
                messagebox.showerror("Ø®Ø·Ø£", f"ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±:\n{str(e)}")

        export_btn = tk.Button(
            buttons_frame,
            text="ğŸ“¥ ØªØµØ¯ÙŠØ± Excel",
            font=("Tajawal", 12, "bold"),
            bg="#3498db",
            fg="white",
            padx=20,
            pady=10,
            bd=0,
            relief=tk.FLAT,
            cursor="hand2",
            command=export_programs
        )
        export_btn.pack(side=tk.LEFT, padx=(0, 10))

        # Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø£Ù†ÙŠÙ‚
        close_btn = tk.Button(
            buttons_frame,
            text="âœ• Ø¥ØºÙ„Ø§Ù‚",
            font=("Tajawal", 12, "bold"),
            bg="#e74c3c",
            fg="white",
            padx=20,
            pady=10,
            bd=0,
            relief=tk.FLAT,
            cursor="hand2",
            command=programs_window.destroy
        )
        close_btn.pack(side=tk.LEFT)

        # ================== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù…Ø¹ ØªØµÙ…ÙŠÙ… Ù…Ø­Ø³Ù† ==================
        main_container = tk.Frame(programs_window, bg=self.COLORS["background"])
        main_container.pack(fill=tk.BOTH, expand=True, padx=30, pady=20)

        # ================== Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£ÙŠØ³Ø±: Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª ==================
        left_container = tk.Frame(main_container, bg=self.COLORS["card"], relief=tk.RAISED, bd=1)
        left_container.pack(side=tk.LEFT, fill=tk.BOTH, expand=True, padx=(0, 15))

        # Ø´Ø±ÙŠØ· Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙŠØ³Ø±
        left_header = tk.Frame(left_container, bg="#34495e", height=60)
        left_header.pack(fill=tk.X)
        left_header.pack_propagate(False)

        tk.Label(
            left_header,
            text="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©",
            font=("Tajawal", 18, "bold"),
            bg="#34495e",
            fg="white"
        ).pack(expand=True)

        # Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙŠØ³Ø±
        left_content = tk.Frame(left_container, bg=self.COLORS["card"])
        left_content.pack(fill=tk.BOTH, expand=True, padx=20, pady=20)

        # Ø¥Ø·Ø§Ø± Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø­Ø³Ù†
        search_frame = tk.Frame(left_content, bg="#ecf0f1", relief=tk.GROOVE, bd=1)
        search_frame.pack(fill=tk.X, pady=(0, 15))

        search_inner = tk.Frame(search_frame, bg="#ecf0f1")
        search_inner.pack(fill=tk.X, padx=15, pady=10)

        tk.Label(
            search_inner,
            text="ğŸ” Ø§Ù„Ø¨Ø­Ø«:",
            font=("Tajawal", 14, "bold"),
            bg="#ecf0f1",
            fg="#2c3e50"
        ).pack(side=tk.LEFT, padx=(0, 10))

        search_entry = tk.Entry(
            search_inner,
            font=("Tajawal", 13),
            width=35,
            bd=2,
            relief=tk.FLAT,
            bg="white"
        )
        search_entry.pack(side=tk.LEFT, fill=tk.X, expand=True)

        # Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª
        courses_count_label = tk.Label(
            left_content,
            text="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙˆØ±Ø§Øª: 0",
            font=("Tajawal", 12, "bold"),
            bg=self.COLORS["card"],
            fg="#3498db"
        )
        courses_count_label.pack(anchor="w", pady=(0, 10))

        # Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø¨Ø³Ø·Ø©
        courses_listbox_frame = tk.Frame(left_content, bg=self.COLORS["card"])
        courses_listbox_frame.pack(fill=tk.BOTH, expand=True)

        # Listbox Ù…Ø¹ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ±
        courses_scrollbar = tk.Scrollbar(courses_listbox_frame)
        courses_scrollbar.pack(side=tk.RIGHT, fill=tk.Y)

        courses_listbox = tk.Listbox(
            courses_listbox_frame,
            font=("Tajawal", 13),
            bg="white",
            fg="#2c3e50",
            selectmode=tk.MULTIPLE,
            selectbackground="#3498db",
            selectforeground="white",
            yscrollcommand=courses_scrollbar.set,
            height=20,
            bd=1,
            relief=tk.SOLID,
            activestyle='none'
        )
        courses_listbox.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
        courses_scrollbar.config(command=courses_listbox.yview)

        # Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        selected_info_frame = tk.Frame(left_content, bg="#d5dbdb", relief=tk.GROOVE, bd=1)
        selected_info_frame.pack(fill=tk.X, pady=(15, 0))

        selected_info_label = tk.Label(
            selected_info_frame,
            text="ğŸ“Œ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠ Ø¯ÙˆØ±Ø©",
            font=("Tajawal", 12),
            bg="#d5dbdb",
            fg="#2c3e50"
        )
        selected_info_label.pack(pady=10)

        # Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù„ÙˆØ§Ù†
        legend_frame = tk.Frame(left_content, bg=self.COLORS["card"])
        legend_frame.pack(fill=tk.X, pady=(10, 0))

        tk.Label(
            legend_frame,
            text="Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù„ÙˆØ§Ù†:",
            font=("Tajawal", 11, "bold"),
            bg=self.COLORS["card"],
            fg="#2c3e50"
        ).pack(side=tk.LEFT)

        tk.Label(
            legend_frame,
            text="â– ",
            font=("Tajawal", 14),
            bg=self.COLORS["card"],
            fg="white"
        ).pack(side=tk.LEFT, padx=(10, 2))

        tk.Label(
            legend_frame,
            text="Ù…ØªØ§Ø­",
            font=("Tajawal", 10),
            bg=self.COLORS["card"],
            fg="#2c3e50"
        ).pack(side=tk.LEFT)

        tk.Label(
            legend_frame,
            text="â– ",
            font=("Tajawal", 14),
            bg=self.COLORS["card"],
            fg="#c62828"
        ).pack(side=tk.LEFT, padx=(15, 2))

        tk.Label(
            legend_frame,
            text="Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø¨Ø±Ù†Ø§Ù…Ø¬",
            font=("Tajawal", 10),
            bg=self.COLORS["card"],
            fg="#2c3e50"
        ).pack(side=tk.LEFT)

        # ================== Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£ÙŠÙ…Ù†: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ==================
        right_container = tk.Frame(main_container, bg=self.COLORS["card"], relief=tk.RAISED, bd=1)
        right_container.pack(side=tk.RIGHT, fill=tk.BOTH, expand=True, padx=(15, 0))

        # Ø´Ø±ÙŠØ· Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙŠÙ…Ù†
        right_header = tk.Frame(right_container, bg="#27ae60", height=60)
        right_header.pack(fill=tk.X)
        right_header.pack_propagate(False)

        tk.Label(
            right_header,
            text="Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©",
            font=("Tajawal", 18, "bold"),
            bg="#27ae60",
            fg="white"
        ).pack(expand=True)

        # Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙŠÙ…Ù†
        right_content = tk.Frame(right_container, bg=self.COLORS["card"])
        right_content.pack(fill=tk.BOTH, expand=True, padx=20, pady=20)

        # ================== Ù‚Ø³Ù… Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¬Ø¯ÙŠØ¯ ==================
        create_section = tk.Frame(right_content, bg="#ecf0f1", relief=tk.GROOVE, bd=1)
        create_section.pack(fill=tk.X, pady=(0, 20))

        create_inner = tk.Frame(create_section, bg="#ecf0f1")
        create_inner.pack(fill=tk.X, padx=20, pady=15)

        tk.Label(
            create_inner,
            text="âœ¨ Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¬Ø¯ÙŠØ¯",
            font=("Tajawal", 16, "bold"),
            bg="#ecf0f1",
            fg="#2c3e50"
        ).pack(anchor="w", pady=(0, 15))

        # Ø­Ù‚Ù„ Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
        name_frame = tk.Frame(create_inner, bg="#ecf0f1")
        name_frame.pack(fill=tk.X, pady=(0, 10))

        tk.Label(
            name_frame,
            text="Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬:",
            font=("Tajawal", 13),
            bg="#ecf0f1",
            fg="#2c3e50",
            width=12,
            anchor="e"
        ).pack(side=tk.LEFT, padx=(0, 10))

        program_name_entry = tk.Entry(
            name_frame,
            font=("Tajawal", 13),
            width=35,
            bd=2,
            relief=tk.FLAT,
            bg="white"
        )
        program_name_entry.pack(side=tk.LEFT, fill=tk.X, expand=True)

        # Ø­Ù‚Ù„ ÙˆØµÙ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
        desc_frame = tk.Frame(create_inner, bg="#ecf0f1")
        desc_frame.pack(fill=tk.X, pady=(0, 15))

        tk.Label(
            desc_frame,
            text="ÙˆØµÙ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬:",
            font=("Tajawal", 13),
            bg="#ecf0f1",
            fg="#2c3e50",
            width=12,
            anchor="e"
        ).pack(side=tk.LEFT, padx=(0, 10))

        program_desc_entry = tk.Entry(
            desc_frame,
            font=("Tajawal", 13),
            width=35,
            bd=2,
            relief=tk.FLAT,
            bg="white"
        )
        program_desc_entry.pack(side=tk.LEFT, fill=tk.X, expand=True)

        # Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù„Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
        program_selected_label = tk.Label(
            create_inner,
            text="Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©: 0",
            font=("Tajawal", 12),
            bg="#ecf0f1",
            fg="#7f8c8d"
        )
        program_selected_label.pack(anchor="w", pady=(0, 15))

        # Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
        create_btn_frame = tk.Frame(create_inner, bg="#ecf0f1")
        create_btn_frame.pack()

        create_btn = tk.Button(
            create_btn_frame,
            text="âœ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬",
            font=("Tajawal", 14, "bold"),
            bg="#27ae60",
            fg="white",
            padx=30,
            pady=12,
            bd=0,
            relief=tk.FLAT,
            cursor="hand2",
            state=tk.DISABLED,
            command=lambda: create_program()
        )
        create_btn.pack()

        # ================== Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù…Ù†Ø´Ø£Ø© ==================
        programs_label = tk.Label(
            right_content,
            text="ğŸ“¦ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù…Ù†Ø´Ø£Ø©",
            font=("Tajawal", 16, "bold"),
            bg=self.COLORS["card"],
            fg="#2c3e50"
        )
        programs_label.pack(anchor="w", pady=(0, 10))

        # Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬
        programs_listbox_frame = tk.Frame(right_content, bg=self.COLORS["card"])
        programs_listbox_frame.pack(fill=tk.BOTH, expand=True)

        programs_scrollbar = tk.Scrollbar(programs_listbox_frame)
        programs_scrollbar.pack(side=tk.RIGHT, fill=tk.Y)

        programs_listbox = tk.Listbox(
            programs_listbox_frame,
            font=("Tajawal", 13),
            bg="white",
            fg="#2c3e50",
            selectbackground="#27ae60",
            selectforeground="white",
            yscrollcommand=programs_scrollbar.set,
            height=10,
            bd=1,
            relief=tk.SOLID,
            activestyle='none'
        )
        programs_listbox.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
        programs_scrollbar.config(command=programs_listbox.yview)

        # ================== Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¨Ø¬Ø¯ÙŠ Ø§Ù„Ø¹Ø±Ø¨ÙŠ ==================
        def arabic_sort_key(text):
            """Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ±ØªÙŠØ¨ Ù„Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"""
            arabic_order = 'Ø£Ø§Ø¨ØªØ«Ø¬Ø­Ø®Ø¯Ø°Ø±Ø²Ø³Ø´ØµØ¶Ø·Ø¸Ø¹ØºÙÙ‚ÙƒÙ„Ù…Ù†Ù‡ÙˆÙŠ'
            text = text.strip()
            key = []
            for char in text:
                if char in arabic_order:
                    key.append(arabic_order.index(char))
                elif char == 'Ø©':
                    key.append(arabic_order.index('Øª'))
                elif char == 'Ù‰':
                    key.append(arabic_order.index('ÙŠ'))
                elif char == 'Ø¢':
                    key.append(arabic_order.index('Ø§'))
                else:
                    key.append(ord(char))
            return key

        # ================== Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª ==================
        def load_courses():
            """ØªØ­Ù…ÙŠÙ„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù…Ø¹ ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬"""
            courses_listbox.delete(0, tk.END)
            all_courses_data.clear()

            cursor = self.db_conn.cursor()

            # Ø¬Ù„Ø¨ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬
            cursor.execute("""
                SELECT DISTINCT course_id, p.program_name 
                FROM program_courses pc
                JOIN programs p ON pc.program_id = p.id
            """)
            used_courses = {}
            for course_id, program_name in cursor.fetchall():
                if course_id not in used_courses:
                    used_courses[course_id] = []
                used_courses[course_id].append(program_name)

            # Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ±Ø§Øª
            cursor.execute("""
                SELECT c.id, c.course_code, c.course_name, c.course_category,
                       COUNT(p.id) as participants_count
                FROM courses c
                LEFT JOIN participants p ON c.id = p.course_id
                GROUP BY c.id
                ORDER BY c.course_name
            """)

            courses = cursor.fetchall()

            # ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            courses_list = []
            course_name_counter = {}

            for course in courses:
                course_id = course[0]
                course_code = course[1]
                course_name = course[2]
                course_category = course[3] if course[3] else ""
                participants = course[4] if course[4] else 0

                # Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ÙƒØ±Ø±Ø©
                display_name = course_name
                if course_name in course_name_counter:
                    course_name_counter[course_name] += 1
                    display_name = f"{course_name} ({course_code})"
                else:
                    course_name_counter[course_name] = 1
                    temp_count = sum(1 for c in courses if c[2] == course_name)
                    if temp_count > 1:
                        display_name = f"{course_name} ({course_code})"

                # ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
                all_courses_data[display_name] = {
                    'id': course_id,
                    'code': course_code,
                    'name': course_name,
                    'category': course_category,
                    'participants': participants,
                    'display_name': display_name,
                    'used_in_programs': used_courses.get(course_id, [])
                }

                courses_list.append(display_name)

            # ØªØ±ØªÙŠØ¨ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ø¨Ø¬Ø¯ÙŠØ§Ù‹
            try:
                courses_list.sort(key=arabic_sort_key)
            except:
                courses_list.sort()

            # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…Ø¹ Ø§Ù„ØªÙ„ÙˆÙŠÙ†
            for idx, course_name in enumerate(courses_list):
                courses_listbox.insert(tk.END, course_name)

                # ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
                if all_courses_data[course_name]['used_in_programs']:
                    courses_listbox.itemconfig(idx, {'bg': '#ffebee', 'fg': '#c62828'})

            # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
            available_count = sum(1 for c in all_courses_data.values() if not c['used_in_programs'])
            used_count = len(courses_list) - available_count
            courses_count_label.config(
                text=f"Ø¥Ø¬Ù…Ø§Ù„ÙŠ: {len(courses_list)} | Ù…ØªØ§Ø­: {available_count} | Ù…Ø³ØªØ®Ø¯Ù…: {used_count}"
            )

        # ================== Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ==================
        def load_programs():
            """ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"""
            programs_listbox.delete(0, tk.END)
            programs_data.clear()

            cursor = self.db_conn.cursor()
            cursor.execute("""
                SELECT p.id, p.program_name, p.program_description, 
                       COUNT(DISTINCT pc.course_id) as courses_count,
                       SUM(CASE WHEN part.id IS NOT NULL THEN 1 ELSE 0 END) as participants_count
                FROM programs p
                LEFT JOIN program_courses pc ON p.id = pc.program_id
                LEFT JOIN courses c ON pc.course_id = c.id
                LEFT JOIN participants part ON c.id = part.course_id
                GROUP BY p.id
                ORDER BY p.id DESC
            """)

            programs = cursor.fetchall()

            for prog in programs:
                prog_id = prog[0]
                prog_name = prog[1]
                prog_desc = prog[2]
                courses_count = prog[3] if prog[3] else 0
                participants_count = prog[4] if prog[4] else 0

                # Ø¬Ù„Ø¨ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
                cursor.execute("""
                    SELECT c.id, c.course_code, c.course_name, c.course_category,
                           COUNT(p.id) as participants_count
                    FROM program_courses pc
                    JOIN courses c ON pc.course_id = c.id
                    LEFT JOIN participants p ON c.id = p.course_id
                    WHERE pc.program_id = ?
                    GROUP BY c.id
                """, (prog_id,))

                program_courses = []
                for course in cursor.fetchall():
                    program_courses.append({
                        'id': course[0],
                        'code': course[1],
                        'name': course[2],
                        'category': course[3] if course[3] else '',
                        'participants': course[4] if course[4] else 0
                    })

                # ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹
                programs_data[prog_id] = {
                    'name': prog_name,
                    'description': prog_desc if prog_desc else '',
                    'courses': program_courses,
                    'total_courses': courses_count,
                    'total_participants': participants_count
                }

                # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                programs_listbox.insert(
                    tk.END,
                    f"{prog_name} ({courses_count} Ø¯ÙˆØ±Ø© - {participants_count} Ù…Ø´Ø§Ø±Ùƒ)"
                )

        # ================== Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« ==================
        def search_courses(event=None):
            """Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ±Ø§Øª"""
            search_text = search_entry.get().strip().lower()

            courses_listbox.delete(0, tk.END)

            filtered_courses = []
            for display_name, course_data in all_courses_data.items():
                if not search_text or (
                        search_text in course_data['name'].lower() or
                        search_text in course_data['code'].lower() or
                        search_text in display_name.lower()
                ):
                    filtered_courses.append(display_name)

            try:
                filtered_courses.sort(key=arabic_sort_key)
            except:
                filtered_courses.sort()

            for course_name in filtered_courses:
                courses_listbox.insert(tk.END, course_name)

            if search_text:
                courses_count_label.config(text=f"Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«: {len(filtered_courses)}")
            else:
                courses_count_label.config(text=f"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙˆØ±Ø§Øª: {len(filtered_courses)}")

        search_entry.bind('<KeyRelease>', search_courses)

        # ================== Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª ==================
        def on_courses_select(event=None):
            """Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù…Ø¹ Ù…Ù†Ø¹ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©"""
            selected_indices = list(courses_listbox.curselection())

            selected_courses_for_program.clear()

            # ØªØµÙÙŠØ© Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
            valid_selections = []
            for index in selected_indices:
                course_name = courses_listbox.get(index)
                if course_name in all_courses_data:
                    course_data = all_courses_data[course_name]

                    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¯ÙˆØ±Ø© ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…Ø©
                    if course_data['used_in_programs']:
                        # Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
                        courses_listbox.selection_clear(index)
                        messagebox.showwarning(
                            "ØªÙ†Ø¨ÙŠÙ‡",
                            f"Ø§Ù„Ø¯ÙˆØ±Ø© '{course_data['name']}' Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬:\n" +
                            "\n".join(course_data['used_in_programs'])
                        )
                    else:
                        selected_courses_for_program.append(course_data)
                        valid_selections.append(index)

            count = len(selected_courses_for_program)
            if count > 0:
                selected_info_label.config(
                    text=f"ğŸ“Œ ØªÙ… ØªØ­Ø¯ÙŠØ¯ {count} Ø¯ÙˆØ±Ø©",
                    fg="#27ae60"
                )
                program_selected_label.config(text=f"Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©: {count}")
                create_btn.config(state=tk.NORMAL)
            else:
                selected_info_label.config(
                    text="ğŸ“Œ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠ Ø¯ÙˆØ±Ø©",
                    fg="#2c3e50"
                )
                program_selected_label.config(text="Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©: 0")
                create_btn.config(state=tk.DISABLED)

        courses_listbox.bind('<<ListboxSelect>>', on_courses_select)

        # ================== Ø¯Ø§Ù„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ==================
        def create_program():
            """Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¬Ø¯ÙŠØ¯ ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"""
            program_name = program_name_entry.get().strip()
            program_desc = program_desc_entry.get().strip()

            if not program_name:
                messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬")
                return

            if len(selected_courses_for_program) == 0:
                messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¯ÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„")
                return

            try:
                import datetime

                # Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                cursor = self.db_conn.cursor()
                cursor.execute("""
                    INSERT INTO programs (program_name, program_description, created_date, created_by)
                    VALUES (?, ?, ?, ?)
                """, (
                    program_name,
                    program_desc,
                    datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
                    self.current_user["full_name"] if self.current_user else "Ø§Ù„Ù†Ø¸Ø§Ù…"
                ))

                program_id = cursor.lastrowid

                # Ø±Ø¨Ø· Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø¨Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
                for course in selected_courses_for_program:
                    cursor.execute("""
                        INSERT INTO program_courses (program_id, course_id)
                        VALUES (?, ?)
                    """, (program_id, course['id']))

                self.db_conn.commit()

                # Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
                program_name_entry.delete(0, tk.END)
                program_desc_entry.delete(0, tk.END)
                selected_courses_for_program.clear()
                program_selected_label.config(text="Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©: 0")
                create_btn.config(state=tk.DISABLED)

                # Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª
                courses_listbox.selection_clear(0, tk.END)
                selected_info_label.config(text="ğŸ“Œ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠ Ø¯ÙˆØ±Ø©", fg="#2c3e50")

                messagebox.showinfo("Ù†Ø¬Ø§Ø­", f"ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ '{program_name}' Ø¨Ù†Ø¬Ø§Ø­")

                # Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬
                load_programs()

            except Exception as e:
                messagebox.showerror("Ø®Ø·Ø£", f"ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬:\n{str(e)}")
                self.db_conn.rollback()

        # ================== Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ==================
        def delete_program():
            """Ø­Ø°Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ù…Ø­Ø¯Ø¯"""
            selection = programs_listbox.curselection()
            if not selection:
                messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù„Ù„Ø­Ø°Ù")
                return

            program_text = programs_listbox.get(selection[0])
            program_name = program_text.split(" (")[0]

            if messagebox.askyesno("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù", f"Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ '{program_name}'ØŸ"):
                try:
                    # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¹Ø±Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
                    cursor = self.db_conn.cursor()
                    cursor.execute("SELECT id FROM programs WHERE program_name = ?", (program_name,))
                    result = cursor.fetchone()

                    if result:
                        prog_id = result[0]

                        # Ø­Ø°Ù Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø£ÙˆÙ„Ø§Ù‹
                        cursor.execute("DELETE FROM program_courses WHERE program_id = ?", (prog_id,))

                        # Ø­Ø°Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
                        cursor.execute("DELETE FROM programs WHERE id = ?", (prog_id,))

                        self.db_conn.commit()

                        messagebox.showinfo("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¨Ù†Ø¬Ø§Ø­")
                        load_programs()

                except Exception as e:
                    messagebox.showerror("Ø®Ø·Ø£", f"ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬:\n{str(e)}")
                    self.db_conn.rollback()

        # Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø²Ø± Ø§Ù„Ù…Ø§ÙˆØ³ Ø§Ù„Ø£ÙŠÙ…Ù† Ù„Ù„Ø¨Ø±Ø§Ù…Ø¬
        def on_program_right_click(event):
            """Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ù‚ Ù„Ù„Ø¨Ø±Ø§Ù…Ø¬"""
            selection = programs_listbox.curselection()
            if not selection:
                return

            context_menu = tk.Menu(programs_window, tearoff=0)
            context_menu.add_command(label="ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„", command=lambda: show_program_details())
            context_menu.add_command(label="âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬", command=lambda: edit_program())
            context_menu.add_separator()
            context_menu.add_command(label="ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬", command=delete_program)

            context_menu.post(event.x_root, event.y_root)

        programs_listbox.bind('<Button-3>', on_program_right_click)

        # ================== Ø¯Ø§Ù„Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ==================
        def edit_program():
            """ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ù…Ø­Ø¯Ø¯"""
            selection = programs_listbox.curselection()
            if not selection:
                messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„")
                return

            program_text = programs_listbox.get(selection[0])
            program_name = program_text.split(" (")[0]

            # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            cursor = self.db_conn.cursor()
            cursor.execute("""
                SELECT id, program_name, program_description 
                FROM programs 
                WHERE program_name = ?
            """, (program_name,))

            program_data = cursor.fetchone()
            if not program_data:
                messagebox.showerror("Ø®Ø·Ø£", "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬")
                return

            prog_id, prog_name, prog_desc = program_data

            # Ø¬Ù„Ø¨ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
            cursor.execute("""
                SELECT c.id, c.course_code, c.course_name, c.course_category,
                       COUNT(p.id) as participants_count
                FROM program_courses pc
                JOIN courses c ON pc.course_id = c.id
                LEFT JOIN participants p ON c.id = p.course_id
                WHERE pc.program_id = ?
                GROUP BY c.id
            """, (prog_id,))

            program_courses = cursor.fetchall()

            # Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            edit_window = tk.Toplevel(programs_window)
            edit_window.title(f"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬: {prog_name}")
            edit_window.geometry("1000x700")
            edit_window.configure(bg=self.COLORS["background"])
            edit_window.transient(programs_window)
            edit_window.grab_set()

            # ØªÙˆØ³ÙŠØ· Ø§Ù„Ù†Ø§ÙØ°Ø©
            edit_window.update_idletasks()
            x = (edit_window.winfo_screenwidth() - 1000) // 2
            y = (edit_window.winfo_screenheight() - 700) // 2
            edit_window.geometry(f"1000x700+{x}+{y}")

            # Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ
            header = tk.Frame(edit_window, bg="#e67e22", height=80)
            header.pack(fill=tk.X)
            header.pack_propagate(False)

            tk.Label(
                header,
                text=f"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬: {prog_name}",
                font=("Tajawal", 24, "bold"),
                bg="#e67e22",
                fg="white"
            ).pack(expand=True)

            # Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
            close_btn = tk.Button(
                header,
                text="âœ• Ø¥ØºÙ„Ø§Ù‚",
                font=("Tajawal", 11, "bold"),
                bg="#c0392b",
                fg="white",
                padx=15,
                pady=8,
                bd=0,
                relief=tk.FLAT,
                cursor="hand2",
                command=edit_window.destroy
            )
            close_btn.place(relx=0.98, rely=0.5, anchor="e")

            # Ø§Ù„Ù…Ø­ØªÙˆÙ‰
            content = tk.Frame(edit_window, bg=self.COLORS["background"])
            content.pack(fill=tk.BOTH, expand=True, padx=20, pady=20)

            # ================== Ù‚Ø³Ù… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ==================
            info_frame = tk.Frame(content, bg=self.COLORS["card"], relief=tk.RAISED, bd=1)
            info_frame.pack(fill=tk.X, pady=(0, 15))

            info_inner = tk.Frame(info_frame, bg=self.COLORS["card"], padx=20, pady=20)
            info_inner.pack(fill=tk.BOTH)

            # Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
            name_frame = tk.Frame(info_inner, bg=self.COLORS["card"])
            name_frame.pack(fill=tk.X, pady=(0, 15))

            tk.Label(
                name_frame,
                text="Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬:",
                font=("Tajawal", 13, "bold"),
                bg=self.COLORS["card"],
                fg="#2c3e50",
                width=12
            ).pack(side=tk.LEFT)

            name_entry = tk.Entry(
                name_frame,
                font=("Tajawal", 13),
                width=40,
                bd=2,
                relief=tk.GROOVE
            )
            name_entry.pack(side=tk.LEFT, padx=10)
            name_entry.insert(0, prog_name)

            # ÙˆØµÙ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
            desc_frame = tk.Frame(info_inner, bg=self.COLORS["card"])
            desc_frame.pack(fill=tk.X)

            tk.Label(
                desc_frame,
                text="ÙˆØµÙ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬:",
                font=("Tajawal", 13, "bold"),
                bg=self.COLORS["card"],
                fg="#2c3e50",
                width=12
            ).pack(side=tk.LEFT)

            desc_entry = tk.Entry(
                desc_frame,
                font=("Tajawal", 13),
                width=40,
                bd=2,
                relief=tk.GROOVE
            )
            desc_entry.pack(side=tk.LEFT, padx=10)
            desc_entry.insert(0, prog_desc if prog_desc else "")

            # Ø²Ø± Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            def save_basic_info():
                new_name = name_entry.get().strip()
                new_desc = desc_entry.get().strip()

                if not new_name:
                    messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", "ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ù„Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬")
                    return

                try:
                    cursor.execute("""
                        UPDATE programs 
                        SET program_name = ?, program_description = ?
                        WHERE id = ?
                    """, (new_name, new_desc, prog_id))

                    self.db_conn.commit()
                    messagebox.showinfo("Ù†Ø¬Ø§Ø­", "ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬")
                    load_programs()

                except Exception as e:
                    messagebox.showerror("Ø®Ø·Ø£", f"ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª:\n{str(e)}")

            save_info_btn = tk.Button(
                info_inner,
                text="ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©",
                font=("Tajawal", 12, "bold"),
                bg="#27ae60",
                fg="white",
                padx=20,
                pady=10,
                bd=0,
                relief=tk.FLAT,
                cursor="hand2",
                command=save_basic_info
            )
            save_info_btn.pack(pady=(15, 0))

            # ================== Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª ==================
            courses_frame = tk.Frame(content, bg=self.COLORS["card"], relief=tk.RAISED, bd=1)
            courses_frame.pack(fill=tk.BOTH, expand=True)

            # Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            courses_header = tk.Frame(courses_frame, bg="#34495e", height=40)
            courses_header.pack(fill=tk.X)
            courses_header.pack_propagate(False)

            tk.Label(
                courses_header,
                text="Ø¥Ø¯Ø§Ø±Ø© Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬",
                font=("Tajawal", 14, "bold"),
                bg="#34495e",
                fg="white"
            ).pack(expand=True)

            courses_content = tk.Frame(courses_frame, bg=self.COLORS["card"])
            courses_content.pack(fill=tk.BOTH, expand=True, padx=20, pady=20)

            # Ø¥Ø·Ø§Ø± Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
            lists_frame = tk.Frame(courses_content, bg=self.COLORS["card"])
            lists_frame.pack(fill=tk.BOTH, expand=True)

            # ================== Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠØ³Ø±Ù‰: Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ==================
            current_frame = tk.Frame(lists_frame, bg=self.COLORS["card"])
            current_frame.pack(side=tk.LEFT, fill=tk.BOTH, expand=True, padx=(0, 10))

            tk.Label(
                current_frame,
                text="Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬:",
                font=("Tajawal", 13, "bold"),
                bg=self.COLORS["card"],
                fg="#2c3e50"
            ).pack(anchor="w", pady=(0, 10))

            # Listbox Ù„Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            current_listbox_frame = tk.Frame(current_frame, bg=self.COLORS["card"])
            current_listbox_frame.pack(fill=tk.BOTH, expand=True)

            current_scrollbar = tk.Scrollbar(current_listbox_frame)
            current_scrollbar.pack(side=tk.RIGHT, fill=tk.Y)

            current_listbox = tk.Listbox(
                current_listbox_frame,
                font=("Tajawal", 12),
                bg="white",
                fg="#2c3e50",
                selectmode=tk.MULTIPLE,
                selectbackground="#e74c3c",
                selectforeground="white",
                yscrollcommand=current_scrollbar.set,
                height=15
            )
            current_listbox.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
            current_scrollbar.config(command=current_listbox.yview)

            # Ù…Ù„Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            for course in program_courses:
                current_listbox.insert(tk.END, f"{course[2]} ({course[1]})")

            # ================== Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙˆØ³Ø·ÙŠØ© ==================
            buttons_frame = tk.Frame(lists_frame, bg=self.COLORS["card"])
            buttons_frame.pack(side=tk.LEFT, padx=20)

            def remove_courses():
                """Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù…Ù† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬"""
                selected = current_listbox.curselection()
                if not selected:
                    messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", "Ø§Ø®ØªØ± Ø¯ÙˆØ±Ø© Ø£Ùˆ Ø£ÙƒØ«Ø± Ù„Ù„Ø¥Ø²Ø§Ù„Ø©")
                    return

                # Ø¬Ù…Ø¹ Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù„Ù„Ø­Ø°Ù
                courses_to_remove = []
                for idx in selected:
                    course_text = current_listbox.get(idx)
                    course_code = course_text.split("(")[1].split(")")[0]

                    # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¹Ø±Ù Ø§Ù„Ø¯ÙˆØ±Ø©
                    for course in program_courses:
                        if course[1] == course_code:
                            courses_to_remove.append(course[0])
                            break

                if messagebox.askyesno("ØªØ£ÙƒÙŠØ¯", f"Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø²Ø§Ù„Ø© {len(courses_to_remove)} Ø¯ÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ØŸ"):
                    try:
                        for course_id in courses_to_remove:
                            cursor.execute("""
                                DELETE FROM program_courses 
                                WHERE program_id = ? AND course_id = ?
                            """, (prog_id, course_id))

                        self.db_conn.commit()

                        # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
                        for idx in reversed(selected):
                            item = current_listbox.get(idx)
                            current_listbox.delete(idx)
                            available_listbox.insert(tk.END, item)

                        messagebox.showinfo("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù…Ù† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬")
                        load_programs()
                        load_courses()

                    except Exception as e:
                        messagebox.showerror("Ø®Ø·Ø£", f"ÙØ´Ù„ ÙÙŠ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª:\n{str(e)}")

            remove_btn = tk.Button(
                buttons_frame,
                text="â—€ Ø¥Ø²Ø§Ù„Ø©",
                font=("Tajawal", 12, "bold"),
                bg="#e74c3c",
                fg="white",
                padx=20,
                pady=10,
                bd=0,
                relief=tk.FLAT,
                cursor="hand2",
                command=remove_courses
            )
            remove_btn.pack(pady=10)

            def add_courses():
                """Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬"""
                selected = available_listbox.curselection()
                if not selected:
                    messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", "Ø§Ø®ØªØ± Ø¯ÙˆØ±Ø© Ø£Ùˆ Ø£ÙƒØ«Ø± Ù„Ù„Ø¥Ø¶Ø§ÙØ©")
                    return

                # Ø¬Ù…Ø¹ Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù„Ù„Ø¥Ø¶Ø§ÙØ©
                courses_to_add = []
                for idx in selected:
                    course_text = available_listbox.get(idx)
                    course_code = course_text.split("(")[1].split(")")[0]

                    # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¹Ø±Ù Ø§Ù„Ø¯ÙˆØ±Ø©
                    cursor.execute("SELECT id FROM courses WHERE course_code = ?", (course_code,))
                    result = cursor.fetchone()
                    if result:
                        courses_to_add.append(result[0])

                if courses_to_add:
                    try:
                        for course_id in courses_to_add:
                            cursor.execute("""
                                INSERT INTO program_courses (program_id, course_id)
                                VALUES (?, ?)
                            """, (prog_id, course_id))

                        self.db_conn.commit()

                        # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
                        for idx in reversed(selected):
                            item = available_listbox.get(idx)
                            available_listbox.delete(idx)
                            current_listbox.insert(tk.END, item)

                        messagebox.showinfo("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù„Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬")
                        load_programs()
                        load_courses()

                    except Exception as e:
                        messagebox.showerror("Ø®Ø·Ø£", f"ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙˆØ±Ø§Øª:\n{str(e)}")

            add_btn = tk.Button(
                buttons_frame,
                text="Ø¥Ø¶Ø§ÙØ© â–¶",
                font=("Tajawal", 12, "bold"),
                bg="#27ae60",
                fg="white",
                padx=20,
                pady=10,
                bd=0,
                relief=tk.FLAT,
                cursor="hand2",
                command=add_courses
            )
            add_btn.pack(pady=10)

            # ================== Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠÙ…Ù†Ù‰: Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© ==================
            available_frame = tk.Frame(lists_frame, bg=self.COLORS["card"])
            available_frame.pack(side=tk.RIGHT, fill=tk.BOTH, expand=True, padx=(10, 0))

            tk.Label(
                available_frame,
                text="Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¥Ø¶Ø§ÙØ©:",
                font=("Tajawal", 13, "bold"),
                bg=self.COLORS["card"],
                fg="#2c3e50"
            ).pack(anchor="w", pady=(0, 10))

            # Listbox Ù„Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
            available_listbox_frame = tk.Frame(available_frame, bg=self.COLORS["card"])
            available_listbox_frame.pack(fill=tk.BOTH, expand=True)

            available_scrollbar = tk.Scrollbar(available_listbox_frame)
            available_scrollbar.pack(side=tk.RIGHT, fill=tk.Y)

            available_listbox = tk.Listbox(
                available_listbox_frame,
                font=("Tajawal", 12),
                bg="white",
                fg="#2c3e50",
                selectmode=tk.MULTIPLE,
                selectbackground="#27ae60",
                selectforeground="white",
                yscrollcommand=available_scrollbar.set,
                height=15
            )
            available_listbox.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
            available_scrollbar.config(command=available_listbox.yview)

            # Ø¬Ù„Ø¨ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© (ØºÙŠØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø£ÙŠ Ø¨Ø±Ù†Ø§Ù…Ø¬)
            cursor.execute("""
                SELECT c.id, c.course_code, c.course_name
                FROM courses c
                WHERE c.id NOT IN (
                    SELECT DISTINCT course_id FROM program_courses
                )
                ORDER BY c.course_name
            """)

            available_courses = cursor.fetchall()
            for course in available_courses:
                available_listbox.insert(tk.END, f"{course[2]} ({course[1]})")

        # ================== Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ==================
        def show_program_details(event=None):
            """Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬"""
            selection = programs_listbox.curselection()
            if not selection:
                return

            program_text = programs_listbox.get(selection[0])
            program_name = program_text.split(" (")[0]

            # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙÙŠ Ø§Ù„Ù‚Ø§Ù…ÙˆØ³
            program_details = None
            program_id = None
            for prog_id, prog_data in programs_data.items():
                if prog_data['name'] == program_name:
                    program_details = prog_data
                    program_id = prog_id
                    break

            if not program_details:
                return

            # Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„
            details_window = tk.Toplevel(programs_window)
            details_window.title(f"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬: {program_name}")
            details_window.geometry("900x650")
            details_window.configure(bg=self.COLORS["background"])
            details_window.transient(programs_window)
            details_window.grab_set()

            # ØªÙˆØ³ÙŠØ· Ø§Ù„Ù†Ø§ÙØ°Ø©
            details_window.update_idletasks()
            x = (details_window.winfo_screenwidth() - 900) // 2
            y = (details_window.winfo_screenheight() - 650) // 2
            details_window.geometry(f"900x650+{x}+{y}")

            # Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ
            header = tk.Frame(details_window, bg="#27ae60", height=100)
            header.pack(fill=tk.X)
            header.pack_propagate(False)

            header_content = tk.Frame(header, bg="#27ae60")
            header_content.pack(expand=True)

            tk.Label(
                header_content,
                text=f"ğŸ“¦ {program_name}",
                font=("Tajawal", 24, "bold"),
                bg="#27ae60",
                fg="white"
            ).pack(pady=(20, 5))

            tk.Label(
                header_content,
                text=f"{program_details['description']}",
                font=("Tajawal", 14),
                bg="#27ae60",
                fg="#e8f8f5"
            ).pack()

            # Ø§Ù„Ù…Ø­ØªÙˆÙ‰
            content_frame = tk.Frame(details_window, bg=self.COLORS["card"])
            content_frame.pack(fill=tk.BOTH, expand=True, padx=20, pady=20)

            # Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            stats_frame = tk.Frame(content_frame, bg="#ecf0f1", relief=tk.GROOVE, bd=1)
            stats_frame.pack(fill=tk.X, pady=(0, 20))

            stats_inner = tk.Frame(stats_frame, bg="#ecf0f1")
            stats_inner.pack(pady=15)

            tk.Label(
                stats_inner,
                text=f"ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª: {program_details['total_courses']}",
                font=("Tajawal", 14, "bold"),
                bg="#ecf0f1",
                fg="#2980b9"
            ).pack(side=tk.LEFT, padx=30)

            tk.Label(
                stats_inner,
                text=f"ğŸ‘¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†: {program_details['total_participants']}",
                font=("Tajawal", 14, "bold"),
                bg="#ecf0f1",
                fg="#e74c3c"
            ).pack(side=tk.LEFT, padx=30)

            # Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª
            tk.Label(
                content_frame,
                text="Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ØªØ¶Ù…Ù†Ø© ÙÙŠ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬:",
                font=("Tajawal", 16, "bold"),
                bg=self.COLORS["card"],
                fg="#2c3e50"
            ).pack(anchor="w", pady=(0, 10))

            # Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª
            from tkinter import ttk

            courses_frame = tk.Frame(content_frame, bg=self.COLORS["card"])
            courses_frame.pack(fill=tk.BOTH, expand=True)

            columns = ("Ù…", "Ø±Ù‚Ù… Ø§Ù„Ø¯ÙˆØ±Ø©", "Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©", "Ø§Ù„ÙØ¦Ø©", "Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†")
            details_tree = ttk.Treeview(courses_frame, columns=columns, show="headings", height=12)

            details_tree.column("Ù…", width=50, anchor="center")
            details_tree.column("Ø±Ù‚Ù… Ø§Ù„Ø¯ÙˆØ±Ø©", width=120, anchor="center")
            details_tree.column("Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©", width=350, anchor="center")
            details_tree.column("Ø§Ù„ÙØ¦Ø©", width=150, anchor="center")
            details_tree.column("Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†", width=130, anchor="center")

            for col in columns:
                details_tree.heading(col, text=col)

            style = ttk.Style()
            style.configure("Treeview.Heading", font=("Tajawal", 12, "bold"))
            style.configure("Treeview", font=("Tajawal", 11), rowheight=30)

            for idx, course in enumerate(program_details['courses'], 1):
                details_tree.insert("", tk.END, values=(
                    idx,
                    course['code'],
                    course['name'],
                    course['category'],
                    course['participants']
                ))

            details_scrollbar = ttk.Scrollbar(courses_frame, orient="vertical", command=details_tree.yview)
            details_tree.configure(yscrollcommand=details_scrollbar.set)

            details_tree.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
            details_scrollbar.pack(side=tk.RIGHT, fill=tk.Y)

            # Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
            close_frame = tk.Frame(content_frame, bg=self.COLORS["card"])
            close_frame.pack(pady=20)

            tk.Button(
                close_frame,
                text="Ø¥ØºÙ„Ø§Ù‚",
                font=("Tajawal", 14, "bold"),
                bg="#34495e",
                fg="white",
                padx=40,
                pady=12,
                bd=0,
                relief=tk.FLAT,
                cursor="hand2",
                command=details_window.destroy
            ).pack()

        programs_listbox.bind('<Double-Button-1>', show_program_details)

        # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
        load_courses()
        load_programs()


# Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
if __name__ == "__main__":
    root = tk.Tk()
    LoginSystem(root)
    root.mainloop()
